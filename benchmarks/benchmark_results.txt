MongoDB (results in seconds)

Range query result:
[0.2944681644439697,
 0.28916096687316895,
 0.28372716903686523,
 0.2791900634765625,
 0.2728259563446045,
 0.26642394065856934,
 0.2685720920562744,
 0.2707080841064453,
 0.2879960536956787,
 0.2799499034881592]

MapReduce query result:
[18.051552057266235,
 18.613569021224976,
 18.319264888763428,
 17.81685209274292,
 17.945057153701782,
 18.78616499900818,
 18.92860722541809,
 19.2401340007782,
 19.187970876693726,
 17.783262968063354]

200 threads in workload simulation, save results off
Workload simulation result
[6.945255994796753,
 7.298089981079102,
 7.059103012084961,
 7.227065801620483,
 7.4749579429626465,
 7.59293007850647,
 8.128200054168701,
 8.516998052597046,
 7.649991035461426,
 7.728899002075195]

 CouchDB (results in seconds)

Range query result:
[0.031234025955200195,
 0.014580965042114258,
 0.010600090026855469,
 0.007702827453613281,
 0.010009050369262695,
 0.007850170135498047,
 0.008256912231445312,
 0.008105039596557617,
 0.007946968078613281,
 0.008790969848632812]

MapReduce query result:
[4.510771989822388,
 3.27237606048584,
 3.4142661094665527,
 3.416632890701294,
 3.4731881618499756,
 6.38683295249939,
 6.0542449951171875,
 3.8828580379486084,
 9.240603923797607,
 4.087347030639648]

200 threads in workload simulation, save results off
[2.2395811080932617,
 1.8961679935455322,
 2.164030075073242,
 1.8612802028656006,
 1.9332408905029297,
 1.900036096572876,
 2.1305110454559326,
 2.496000051498413,
 2.28153395652771,
 2.447028160095215]

-------------------------------------------------------------------------------------------------------

Results with input part files 00099, 00098, 00097, 00096

MongoDB, no indexes (results in seconds)

Range query result:
[1.5326299667358398,
 1.4898738861083984,
 1.4623918533325195,
 1.4816408157348633,
 1.4833369255065918,
 1.5891499519348145,
 1.5238518714904785,
 1.4415640830993652,
 1.4449210166931152,
 1.5072910785675049]

 MapReduce query result:
[70.54809594154358,
 63.925912857055664,
 66.14579510688782,
 66.34413814544678,
 64.69570183753967,
 64.34092402458191,
 68.52842998504639,
 67.26464796066284,
 64.55178689956665,
 63.42024302482605]

Aggregation pipeline query result:
[3.791059970855713,
 3.946621894836426,
 3.8957908153533936,
 3.941413164138794,
 3.956423044204712,
 4.0149431228637695,
 3.9785919189453125,
 3.8826398849487305,
 3.924139976501465,
 3.9396979808807373]

 Workload simulation result
[9.978820085525513,
 11.219135999679565,
 12.448333978652954,
 13.257589101791382,
 12.70954704284668,
 13.169378995895386,
 12.752178192138672,
 12.551738977432251,
 12.85796594619751,
 13.709453105926514]


MongoDB

With index on rankings.pageRank, ascending
db.rankings.createIndex( { "pageRank": 1 } )
Range query only uses the rankings collection

 Range query result:
[0.0069751739501953125,
 0.0005190372467041016,
 0.0004899501800537109,
 0.00047087669372558594,
 0.0005898475646972656,
 0.0011899471282958984,
 0.0005280971527099609,
 0.0005171298980712891,
 0.00043487548828125,
 0.0004668235778808594]

MapReduce query with index db.uservisits.createIndex( { "visitDate": 1 } ) where visitDate is a string
No improvement

MapReduce query result:
[70.99035501480103,
 68.80257391929626,
 72.74208807945251,
 69.81059193611145,
 70.96156191825867,
 69.0579481124878,
 69.42003202438354,
 66.90236210823059,
 67.49684190750122,
 68.24389886856079]

MapReduce query with index db.uservisits.createIndex( { "visitDate": "text" } )
No improvement

Running MapReduce query...
MapReduce query result:
[76.21945405006409,
 66.9559121131897,
 74.90916609764099,
 70.35450291633606,
 71.1877760887146,
 71.1880431175232,
 72.83435606956482,
 71.03679895401001,
 71.5815601348877,
 69.21008086204529]

MapReduce query with index db.uservisits.createIndex( { "visitDate": 1 } ) where visitDate is an ISODate
No improvement

 MapReduce query result:
[73.89242601394653,
 75.04764413833618,
 72.95926785469055,
 68.43926119804382,
 71.70572090148926,
 70.90666103363037,
 70.07892203330994,
 71.0907289981842,
 70.06156492233276,
 71.9105589389801]

Running it again:

Running MapReduce query...
MapReduce query result:
[69.20632815361023,
 69.5830888748169,
 66.55808591842651,
 64.9306218624115,
 66.87332892417908,
 65.97534704208374,
 71.45677304267883,
 70.00313091278076,
 67.77361392974854,
 70.5177800655365]

 MapReduce query with index db.uservisits.createIndex( { "visitDate": 1 } ) where visitDate is an ISODate and input documents for the mapper are sorted by visitDate ascending
 No improvement, worse actually

MapReduce query result:
[81.90266013145447,
 82.44332385063171,
 82.03059601783752,
 81.15557408332825,
 83.75921416282654,
 78.38861083984375,
 77.76844882965088,
 75.51889896392822,
 80.69941091537476,
 79.93924903869629]

Running it again:

Running MapReduce query...
MapReduce query result:
[88.38885283470154,
 86.50386714935303,
 85.46894192695618,
 84.78550982475281,
 86.69200491905212,
 84.51282811164856,
 81.62038707733154,
 79.00121402740479,
 78.72037410736084,
 77.14250302314758]

Workload simulation with index on rankings.pageRank, ascending:

Running workload simulation...
Workload simulation result
[0.18584895133972168,
 0.12671399116516113,
 0.15474200248718262,
 0.15935397148132324,
 0.17854905128479004,
 0.19500112533569336,
 0.21245503425598145,
 0.22412395477294922,
 0.2534151077270508,
 0.2961139678955078] 

Aggregation query with index db.uservisits.createIndex( { "visitDate": 1 } ) where visitDate is an ISODate

Running aggregation pipeline query...
Aggregation pipeline query result:
[3.7452030181884766,
 3.6838958263397217,
 3.7853500843048096,
 3.6357228755950928,
 3.9267261028289795,
 3.913499116897583,
 3.8432929515838623,
 3.714137077331543,
 3.7518560886383057,
 3.752531051635742]

Running it again:

Aggregation pipeline query result:
[3.970118999481201,
 3.951598882675171,
 4.096091985702515,
 3.9915308952331543,
 4.133204936981201,
 3.9935288429260254,
 3.8808369636535645,
 4.046357154846191,
 3.87021803855896,
 3.9836740493774414]

Aggregation query with index db.uservisits.createIndex( { "visitDate": 1 } ) where visitDate is an ISODate and a sort operation on visitDate in the beginning of the pipeline

 Running aggregation pipeline query...
Aggregation pipeline query result:
[49.5709490776062,
 50.58434700965881,
 49.50186085700989,
 50.891976833343506,
 51.471855878829956,
 52.00241804122925,
 53.01556992530823,
 52.68778085708618,
 51.12340688705444,
 51.047611951828]

---------------------------------------------------------------------------

Mongo clustered, 4 shards, object ID hashed sharding
Using the 4 local benchmark data files (input part files 00099, 00098, 00097, 00096)
Running the benchmark from my machine

No indexes

Range, no indexes

Running range query...
Range query result:
[1.9326059818267822,
 1.5485670566558838,
 1.6386370658874512,
 1.4911108016967773,
 1.5255699157714844,
 1.4796829223632812,
 1.2053661346435547,
 1.613887071609497,
 1.5623140335083008,
 1.1691429615020752]

Running it again

Running range query...
Range query result:
[1.8331589698791504,
 0.8936021327972412,
 1.2979280948638916,
 1.186621904373169,
 0.7931110858917236,
 0.7749850749969482,
 0.7841289043426514,
 1.1015679836273193,
 1.4531030654907227,
 1.010516881942749]

Range, index on pageRank, ascending

Running range query...
Range query result:
[0.16536593437194824,
 0.028326034545898438,
 0.028738021850585938,
 0.028369903564453125,
 0.02845907211303711,
 0.027781963348388672,
 0.0281980037689209,
 0.029376983642578125,
 0.028470993041992188,
 0.028607845306396484]

 Running it again

 Running range query...
Range query result:
[0.1584320068359375,
 0.0321807861328125,
 0.02880692481994629,
 0.029143095016479492,
 0.02822399139404297,
 0.02805495262145996,
 0.028030872344970703,
 0.02853989601135254,
 0.02873396873474121,
 0.02859807014465332]

---------------------------------------------------------------------------

Mongo clustered, 4 shards, object ID hashed sharding
Using the 4 local benchmark data files (input part files 00099, 00098, 00097, 00096)
Running the benchmark from configserver/mongosrouter machine

All benchmarks, no indexes

Running range query...
Range query result:
[0.90482497215271,
 0.8943648338317871,
 0.832819938659668,
 1.4616990089416504,
 1.1206960678100586,
 1.064234972000122,
 1.2000668048858643,
 1.0689270496368408,
 1.0109140872955322,
 1.129741907119751]

 Running it again

 Running range query...
Range query result:
[1.124549150466919,
 1.0160679817199707,
 0.9423699378967285,
 0.9175879955291748,
 0.9733850955963135,
 0.9701910018920898,
 1.161984920501709,
 1.3066108226776123,
 0.9223499298095703,
 0.9027788639068604]

Running MapReduce query...
MapReduce query result:
[60.133702993392944,
 58.989901065826416,
 55.59789514541626,
 52.3237681388855,
 57.27423310279846,
 52.75591707229614,
 52.801005125045776,
 55.46788191795349,
 62.49320101737976,
 55.004201889038086]

 Running aggregation pipeline query...
Aggregation pipeline query result:
[5.095760107040405,
 4.754612922668457,
 5.052337169647217,
 5.105710029602051,
 5.001313924789429,
 5.444516181945801,
 5.518079042434692,
 4.398182153701782,
 4.68666410446167,
 4.839427947998047]

 Running it again

 Aggregation pipeline query result:
[3.8881309032440186,
 4.688041925430298,
 5.456641912460327,
 5.028269052505493,
 5.29137396812439,
 4.5009989738464355,
 4.18333101272583,
 4.617753982543945,
 4.785188913345337,
 4.896203994750977]


 Running workload simulation...
Workload simulation result
[20.684646129608154,
 14.453128814697266,
 13.812062978744507,
 14.279230833053589,
 13.747458934783936,
 17.74012589454651,
 19.129690885543823,
 14.931634902954102,
 15.5312340259552,
 14.948473930358887]


With indexes

db.rankings.createIndex( { "pageRank": 1 } )
db.uservisits.createIndex( { "visitDate": 1 } )

Range

Running range query...
Range query result:
[0.012335062026977539,
 0.00292205810546875,
 0.004403829574584961,
 0.0017931461334228516,
 0.0029518604278564453,
 0.004703998565673828,
 0.0025620460510253906,
 0.0020151138305664062,
 0.002331972122192383,
 0.0019598007202148438] 

 Running it again

Running range query...
Range query result:
[0.003941059112548828,
 0.0014159679412841797,
 0.0012700557708740234,
 0.0011909008026123047,
 0.0012829303741455078,
 0.0012099742889404297,
 0.0011720657348632812,
 0.0014910697937011719,
 0.0011818408966064453,
 0.0011379718780517578] 

 MapReduce

Running MapReduce query...
MapReduce query result:
[58.297597885131836,
 59.27712082862854,
 52.796653032302856,
 58.68579602241516,
 59.5250678062439,
 58.64422106742859,
 59.67854690551758,
 59.14147210121155,
 56.44144010543823,
 59.172714948654175]

Aggregation

Running aggregation pipeline query...
Aggregation pipeline query result:
[6.09829306602478,
 4.364037036895752,
 5.357310056686401,
 5.964401960372925,
 4.602765083312988,
 5.3382790088653564,
 5.122788906097412,
 6.4225969314575195,
 5.8643200397491455,
 5.92699122428894]


Workload

Running workload simulation...
Workload simulation result
[0.5992209911346436,
 0.30409908294677734,
 0.3325541019439697,
 0.31102585792541504,
 0.3260009288787842,
 0.38587188720703125,
 0.3497340679168701,
 0.3504459857940674,
 0.39438295364379883,
 0.4378538131713867]


-------------------------------------------------------------------------------------
Mongo - local files (4 input files) shard distribution

mongos> db.rankings.getShardDistribution()

Shard shard1ReplicaSet at shard1ReplicaSet/188.226.173.163:27018
 data : 143.37MiB docs : 1232169 chunks : 22
 estimated data per chunk : 6.51MiB
 estimated docs per chunk : 56007

Shard shard2ReplicaSet at shard2ReplicaSet/188.226.171.167:27018
 data : 82.1MiB docs : 705736 chunks : 21
 estimated data per chunk : 3.9MiB
 estimated docs per chunk : 33606

Shard shard3ReplicaSet at shard3ReplicaSet/188.226.172.31:27018
 data : 85.1MiB docs : 731664 chunks : 21
 estimated data per chunk : 4.05MiB
 estimated docs per chunk : 34841

Shard shard4ReplicaSet at shard4ReplicaSet/188.226.172.84:27018
 data : 108.26MiB docs : 930431 chunks : 21
 estimated data per chunk : 5.15MiB
 estimated docs per chunk : 44306

Totals
 data : 418.84MiB docs : 3600000 chunks : 85
 Shard shard1ReplicaSet contains 34.23% data, 34.22% docs in cluster, avg obj size on shard : 122B
 Shard shard2ReplicaSet contains 19.6% data, 19.6% docs in cluster, avg obj size on shard : 121B
 Shard shard3ReplicaSet contains 20.31% data, 20.32% docs in cluster, avg obj size on shard : 121B
 Shard shard4ReplicaSet contains 25.84% data, 25.84% docs in cluster, avg obj size on shard : 122B

mongos> db.uservisits.getShardDistribution()

Shard shard1ReplicaSet at shard1ReplicaSet/188.226.173.163:27018
 data : 182.19MiB docs : 611703 chunks : 5
 estimated data per chunk : 36.43MiB
 estimated docs per chunk : 122340

Shard shard2ReplicaSet at shard2ReplicaSet/188.226.171.167:27018
 data : 184.5MiB docs : 619406 chunks : 7
 estimated data per chunk : 26.35MiB
 estimated docs per chunk : 88486

Shard shard3ReplicaSet at shard3ReplicaSet/188.226.172.31:27018
 data : 137.99MiB docs : 463384 chunks : 5
 estimated data per chunk : 27.59MiB
 estimated docs per chunk : 92676

Shard shard4ReplicaSet at shard4ReplicaSet/188.226.172.84:27018
 data : 229.2MiB docs : 769448 chunks : 7
 estimated data per chunk : 32.74MiB
 estimated docs per chunk : 109921

Totals
 data : 733.9MiB docs : 2463941 chunks : 24
 Shard shard1ReplicaSet contains 24.82% data, 24.82% docs in cluster, avg obj size on shard : 312B
 Shard shard2ReplicaSet contains 25.14% data, 25.13% docs in cluster, avg obj size on shard : 312B
 Shard shard3ReplicaSet contains 18.8% data, 18.8% docs in cluster, avg obj size on shard : 312B
 Shard shard4ReplicaSet contains 31.23% data, 31.22% docs in cluster, avg obj size on shard : 312B



-------------------------------------------------------------------------------------
CouchDB - Local benchmark with input part files 00099, 00098, 00097, 00096

Range query result:
[0.03515315055847168,
 0.009013891220092773,
 0.009728193283081055,
 0.009359121322631836,
 0.008511781692504883,
 0.007858037948608398,
 0.01070713996887207,
 0.017590045928955078,
 0.013683080673217773,
 0.009644031524658203]

 MapReduce query result:
[15.44310712814331,
 10.242525815963745,
 10.181946039199829,
 9.721312999725342,
 9.076616048812866,
 10.87264895439148,
 9.184498071670532,
 9.470959186553955,
 12.332551956176758,
 10.479483127593994]

Workload simulation result;
[2.4130780696868896,
 2.4163219928741455,
 2.4111108779907227,
 2.352385997772217,
 2.533130168914795,
 2.601045846939087,
 2.85852313041687,
 3.0654098987579346,
 3.473952054977417,
 3.4809629917144775]

--

CouchDB - 4GB Memory / 60GB Disk / AMS2 - Full benchmark database

Range query result:
[0.05099081993103027,
 0.01820516586303711,
 0.024192094802856445,
 0.024460792541503906,
 0.027560949325561523,
 0.02137899398803711,
 0.03088212013244629,
 0.031225919723510742,
 0.03730416297912598,
 0.026895999908447266]

MapReduce query result:
[85.71805691719055,
 63.585816860198975,
 63.444742918014526,
 63.490386962890625,
 57.55432605743408,
 59.880393981933594,
 52.723257064819336,
 54.8951690196991,
 55.33956813812256,
 60.97784090042114]

Workload simulation result;
[2.7237250804901123,
 3.2064437866210938,
 4.070245981216431,
 2.7459540367126465,
 2.644986152648926,
 2.959406852722168,
 2.76987886428833,
 3.4383649826049805,
 3.506753921508789,
 3.289702892303467]










